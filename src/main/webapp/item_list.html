<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>商品列表</title>
	<script src="js/html5.js"></script>
	<link rel="stylesheet" type="text/css" href="css/styleguide.css">
	<link rel="stylesheet" type="text/css" href="css/font.css">
	<link rel="stylesheet" type="text/css" href="css/itemlist.css">

	<!-- ICON Files -->
	<link rel="shortcut icon" href="ico/favicon.ico">
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
	
	<script type="text/javascript">
		var url = window.location.href;
		var url_array = url.split('cn');
		var final_url = url_array[1];
		console.log(url_array);
		//平台、设备和操作系统   
		var system ={  
			win : false,  
			mac : false,  
			xll : false  
		};  
		//检测平台   
		var p = navigator.platform;  
		//console.log(p);  
		system.win = p.indexOf("Win") == 0;
		system.mac = p.indexOf("Mac") == 0;
		system.x11 = (p == "X11") || (p.indexOf("Linux") == 0);  
		//跳转语句
		if(system.win || system.mac || system.xll) { //转向电脑端
			if(final_url.length == 0) {
				console.log(url_array[0] + "cn/m/index.html");
				window.location.href = url_array[0] + "cn/m/index.html";
			} else if(final_url.indexOf("/m/") == 0) {
				final_url = final_url.split('m/')[1];
				console.log(url_array[0] + "cn/" + final_url);
				window.location.href = url_array[0] + "cn/" + final_url;
			}
		} else {  // 转向手机端
			if(final_url.indexOf("/m/") == -1) {
				console.log(url_array[0] + "cn/m" + final_url);
				window.location.href = url_array[0] + "cn/m" + final_url;
			}
		}
	</script>
</head>
<body class="itemlist">
	<div class="cover"></div>
	<header class="h2">
		<div class="h2b">
			<div class="sesearch">
				<input type="text">
				<span class="icon-magnifier13"></span>
			</div>
			<div class="logo">
				<img src="img/logo.png" alt="logo">
			</div>
			<div class="index">
				<a href="index.html">首页</a>
				<div class="dd2">
					<ul>
						<li><a href="culture.html">山茶文化</a></li>
						<li><a href="brand.html">品牌故事</a></li>
						<li><a href="packagedesign.html">私人定制</a></li>
						<li><a href="item_list.html">商品系列</a></li>
						<li><a href="contact.html">联系我们</a></li>
					</ul>
					<div class="lan">
						简
					</div>
					<div class="r">
						<a href="c_orderlist.html">我的订单</a>
						<a href="login.html">登录</a>|<a href="reg.html">注册</a>
					</div>
				</div>
			</div>
			<div class="secart">
				<a href="cart.html">
					购物车
					<div class="cartn">0</div>
				</a>
			</div>
		</div>
	</header>
	<header class="h1">
		<div class="box">
			<div class="logo">
				<img src="img/logo.png" alt="logo">
			</div>
			<div class="ul1">
				<ul>
					<!-- <li class="pinfo">
						<span>130****0000</span>
						<img src="img/avatar_preview_default.png" alt="avatar">
						<ul class="dd1">
							<li><a href="account.html">我的账户</a></li>
							<li>登出</li>
						</ul>
					</li> -->
					<li class="pinfo"><a href="login.html">登录</a>|<a href="reg.html">注册</a></li>
					<li><a href="c_orderlist.html">我的订单</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			<div class="bbs"><a href="bbs/forum.html">论坛</a></div>
			<div class="ul2">
				<ul>
					<li><a href="contact.html">联系我们</a></li>
					<li><a href="item_list.html">商品系列</a></li>
					<li><a href="packagedesign.html">私人定制</a></li>
					<li><a href="brand.html">品牌故事</a></li>
					<li><a href="culture.html">山茶文化</a></li>
					<li class="active"><a href="index.html">首页</a></li>
				</ul>
			</div>
		</div>
	</header>
	<div class="boxw se">
		<div class="box">
			<ul><li class="active">中</li><li>繁</li><li>JP</li><li>EN</li></ul>
			<div class="sesearch">
				<input type="text" name="seinput">
				<input type="button" name="sebtn" value="搜索">
			</div>
			<div class="secart">
				<a href="cart.html">
					购物车
					<div class="cartn">0</div>
					<span class="icon-arrow-down2"></span>
				</a>
			</div>
		</div>
	</div>
	<div class="clear waypoint"></div>
	<div class="box hcl">
		<div class="hcartlist">
			<div class="list">
				<table>
					<!-- <tr>
						<td class="td1">
							<div class="img">
								<img src="img/listitem.png" alt="img">
							</div>
							<p>
								<span class="n">红天果冷压榨特级初榨茶籽油</span><br>
								<span class="s">500ML</span>
							</p>
						</td>
						<td class="td2">1</td>
						<td class="td3">&yen;200</td>
						<td class="td4">
							<span class="icon-cross"></span>
						</td>
					</tr> -->
				</table>
			</div>
			<div class="b">
				<span class="ttn">共<span>0</span>件商品</span>
				<span class="ttp">总价<span>&yen;0</span></span>
				<input type="button" id="carthtml" value="结算">
			</div>
		</div>
	</div>
	<div class="cartpp">
		<div class="pph">
			选择商品规格数量		
		</div>
		<div class="ppb">
			<table>
				<tr>
					<th class="td1">规格</th>
					<th class="td2">单价</th>
					<th class="td3">操作</th>
				</tr>
				<tr>
					<td class="td1">0.5L</td>
					<td class="td2">&yen;43</td>
					<td class="td3"><div class="icon-checkmark active"></div></td>
				</tr>
				<tr>
					<td class="td1">1L</td>
					<td class="td2">&yen;90</td>
					<td class="td3"><div class="icon-checkmark"></div></td>
				</tr>
				<tr>
					<td class="td1">2L</td>
					<td class="td2">&yen;200</td>
					<td class="td3"><div class="icon-checkmark"></div></td>
				</tr>
			</table>
			<div class="ppbt">数量
				<div class="quantt">
					<div class="icon-minus"></div>
					<div class="num"><input type="text" value="1"></div>
					<div class="icon-plus"></div>
				</div>
			</div>
		</div>
		<div class="ppf">
			<input type="button" name="cancel" value="取消">
			<input type="button" name="addtc" value="加入购物车">
			<div class="clear"></div>
		</div>
	</div>
	<div class="box wrapper">
		<div class="sidebar">
			<ul class="brand">
				<!-- <li class="active">
					红天果
					<span class="icon-arrow-up"></span>
					<span class="icon-arrow-down2"></span>
				</li>
				<ul class="series active">
					<li>食</li>
					<li>身</li>
					<li>家</li>
					<li>礼</li>
				</ul>
				<li>
					红天果
					<span class="icon-arrow-up"></span>
					<span class="icon-arrow-down2"></span>
				</li>
				<ul class="series">
					<li>食</li>
					<li>身</li>
					<li>家</li>
					<li>礼</li>
				</ul>
				<li>
					红天果
					<span class="icon-arrow-up"></span>
					<span class="icon-arrow-down2"></span>
				</li>
				<ul class="series">
					<li>食</li>
					<li>身</li>
					<li>家</li>
					<li>礼</li>
				</ul> -->
			</ul>
			<!--<a href=""><img class="sidebarad" src="img/sidebarad.png" alt="ad"></a>-->
			<div class="top3">
				<div class="top3h">-
					销量排行<span>Top3</span>
				</div>
				<!-- <div class="top3item">
					<div class="img">
						<img src="img/cartitem.png" alt="img">
					</div>
					<p>崙山部落苦茶油<br>500ml</p>
					<div class="sold">已售出:180件</div>
					<div class="price">&yen;66</div>
				</div>
				<div class="top3item">
					<div class="img">
						<img src="img/cartitem.png" alt="img">
					</div>
					<p>崙山部落苦茶油<br>500ml</p>
					<div class="sold">已售出:180件</div>
					<div class="price">&yen;66</div>
				</div>
				<div class="top3item">
					<div class="img">
						<img src="img/cartitem.png" alt="img">
					</div>
					<p>崙山部落苦茶油<br>500ml</p>
					<div class="sold">已售出:180件</div>
					<div class="price">&yen;66</div>
				</div> -->
			</div>
		</div>
		<div class="content">
			<div class="selected">
				已选条件：
				<div class="sltd">
					<!-- <div>品牌1<span class="icon-cross"></span></div>
					<div>1L以下<span class="icon-cross"></span></div> -->
				</div>
				<div class="clear"></div>
			</div>
			<div class="filterh">
				<span>
					筛选条件
					<span class="icon-arrow-down2"></span>
					<span class="icon-arrow-up"></span>
				</span>
				<input type="button" id="ckMe" value="搜索">
			</div>
			<div class="filterb">
				<!-- <div class="filter" name="brand">
					品牌
					<input type="hidden" name="key" value="brand">
					<input type="hidden" name="opt" value="1">
					<input class="nolimit active" type="button" name="brand" value="不限">
					<div class="filtercb brand">
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="1" data-name="品牌1品牌1品牌1">
							</div>品牌1品牌1品牌1
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="2" data-name="品牌2品牌2品牌2">
							</div>品牌2品牌2品牌2
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="3" data-name="品牌3品牌3品牌3">
							</div>品牌3
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="4" data-name="品牌4品牌4品牌4">
							</div>品牌4品牌4品牌4
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="5" data-name="品牌5品牌5品牌5">
							</div>品牌5品牌5
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="6" data-name="品牌6品牌6品牌6">
							</div>品牌6品牌6品牌6
						</div>
					</div>
					<div class="clear"></div>
				</div> -->
				<div class="filter" name="minVolume">
					容量
					<input type="hidden" name="key" value="minVolume">
					<input type="hidden" name="opt" value="2">
					<input class="nolimit active" type="button" name="capacity" value="不限">
					<div class="filtercb minvolume">
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="1000" data-name="1000ML以下">
							</div>1000ML以下
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="1000-2000" data-name="1000ML-2000ML">
							</div>1000ML-2000ML
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="2000" data-name="2000ML以上" optChange="3">
							</div>2000ML以上
						</div>
					</div>
					<div class="clear"></div>
				</div>
				<div class="filter" name="rawMaterial">
					原料
					<input type="hidden" name="key" value="rawMaterial">
					<input type="hidden" name="opt" value="1">
					<input class="nolimit active" type="button" name="rawmaterial" value="不限">
					<div class="filtercb rawmaterial">
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="油茶籽" data-name="油茶籽">
							</div>油茶籽
						</div>
					</div>
					<div class="clear"></div>
				</div>
				<div class="filter" name="minDiscountPrice">
					价格
					<input type="hidden" name="key" value="minDiscountPrice">
					<input type="hidden" name="opt" value="2">
					<input class="nolimit active" type="button" name="price" value="不限">
					<div class="filtercb mindiscountprice">
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="100" data-name="100元以下">
							</div>100元以下
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="100-300" data-name="100-300元">
							</div>100-300元
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="300-500" data-name="300-500元">
							</div>300-500元
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="500" data-name="500元以上" optChange="3">
							</div>500元以上
						</div>
					</div>
					<div class="clear"></div>
				</div>
				<!--<div class="filter hide" name="package">
					包装
					<input type="hidden" name="key" value="package">
					<input type="hidden" name="opt" value="1">
					<input class="nolimit active" type="button" name="package" value="不限">
					<div class="filtercb package">
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="1" data-name="包装1">
							</div>包装1
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="2" data-name="包装2">
							</div>包装2
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="3" data-name="包装3">
							</div>包装3
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="4" data-name="包装4">
							</div>包装4
						</div>
					</div>
					<div class="clear"></div>
				</div>-->
				<div class="filter hide" name="technology">
					工艺
					<input type="hidden" name="key" value="technology">
					<input type="hidden" name="opt" value="1">
					<input class="nolimit active" type="button" name="technics" value="不限">
					<div class="filtercb technology">
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="物理一级压榨" data-name="物理一级压榨">
							</div>物理一级压榨
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="混搭调和" data-name="混搭调和">
							</div>混搭调和
						</div>
						<div class="fb">
							<div class="checkbox icon-checkmark">
								<input type="checkbox" name="val" value="其他" data-name="其他">
							</div>其他
						</div>
					</div>
					<div class="clear"></div>
				</div>
				<div class="filtermore">
					<div class="show">更多选项(工艺)<span class="icon-arrow-down2"></span></div>
					<div class="fold">收起<span class="icon-arrow-up"></span></div>
				</div>
			</div>
			<ul id="searchlist" class="iteml">
				<!-- <li>
					<div class="gp">
						特惠
						<div></div>
					</div>
					<div class="itemimg">
						<img src="img/listitem.png" alt="img">
					</div>
					<div class="idetail">
						<p>
							<span class="n">冷压榨特级初榨茶籽油</span><br>
							<span class="dp">2000</span><span class="p">3900</span>
						</p>
					</div>
					<div class="addtcart">
						加入购物车
					</div>
				</li> -->
			</ul>
			<div class="clear"></div>
			<div class="pager">
				<span class="total">共<span></span>件商品</span>
				<span class="page">
					<!-- <a>1</a>
					<a class="current">2</a>
					<a>3</a>
					<a>4</a>
					<a>5</a>
					<span>&hellip;</span>
					<a>17</a>
					<span class="nextpage">下一页<span class="icon-arrow-right2"></span></span> -->
				</span>
			</div>
		</div>
	</div>
	<footer>
		<div class="box">
			<div class="l">
				<p>
					客户服务<br>
					<span id="site_phone">025-85703619</span>
				</p>
				<p>
					地址<br>
					<span id="site_address">江苏省南京市雨花台区长虹路222号<br>
						德盈国际广场3幢1605室<br>
						江苏红果文化传播有限公司</span>
				</p>
				<p>
					邮箱<br>
					<span id="site_email">srv@uhaou.cn</span>
				</p>
			</div>
			<div class="m">
				<p>订阅有好油，加入我们</p>
				<div class="rss">
					<input type="text" placeholder="请输入您的邮箱">
					<input type="button" value="发送">
				</div>
			</div>
			<div class="r">
				<p>扫一扫有惊喜</p>
				<img id="site_2dcode" src="img/2dcode.jpg" alt="code">
				<div class="site">UHAOU.CN</div>
				<div class="cr" id="site_record">
				</div>
			</div>
		</div>
	</footer>
	<script src="js/jquery.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script src="js/general.js"></script>
	<script src="js/waypoints.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			$(".filterh>span, .filterh>span>span").click(function(){
				if ($(this).hasClass("active")) {
					$(this).removeClass("active");
					$(".filterb").removeClass("active");
				}else{
					$(this).addClass("active");
					$(".filterb").addClass("active");
				}
			});
			
			$.ajax({
				type: 'GET',
				url: './sale/indexBrand',
				success: function(data) {
					var inner = '';
					for(var i = 0; i < data.datas.length; i++) {
						if(i == 0) {
							inner += '<li class="active" name="li_shop" data_name="'+data.datas[i].brandName+'" data_id="'+data.datas[i].id+'">' + data.datas[i].brandName
							 	       +'<span class="icon-arrow-up"></span><span class="icon-arrow-down2"></span></li><ul class="series active">';
						} else {
							inner += '<li name="li_shop" data_id="'+data.datas[i].id+'">' + data.datas[i].brandName
					 	       +'<span class="icon-arrow-up"></span><span class="icon-arrow-down2"></span></li><ul class="series">';
						}
						var seriesArray = data.datas[i].saleShopSeries;
						for(var j = 0; j < seriesArray.length; j++) {
							var seriesObj = seriesArray[j];
							inner += '<li name="li_series" data_id="'+seriesObj.id+'">'+seriesObj.name+'</li>';
						}
						inner += '</ul>';
					}
					$('ul.brand').html(inner);
					
					$('li[name=li_shop]').click(function(e) {
						e.stopPropagation();
						var brand = $(this).attr('data_name');
						var dataArray = [];
						dataArray.push({
							"key": "brand",
							"option": 1,
							"val": brand,
							"page": 1,
							"limit": 9
						});
						itemSearch(1, dataArray);
					});
					
					$('li[name=li_series]').click(function(e) {
						e.stopPropagation();
						var seriesId = $(this).attr('data_id');
						var dataArray = [];
						dataArray.push({
							"key": "seriesId",
							"option": 1,
							"val": seriesId,
							"page": 1,
							"limit": 9
						});
						itemSearch(1, dataArray);
					});
					
					$(".icon-arrow-up, .icon-arrow-down2").click(function(e){
						e.stopPropagation();
						var li_parent = $(this).parent();
						if (li_parent.hasClass("active")) {
							li_parent.removeClass("active").next("ul").removeClass("active");
						}else{
							li_parent.addClass("active").next("ul").addClass("active");
						}
					});
				}
			});
			
			$.ajax({
				type: 'GET',
				url: './sale/rank',
				success: function(data) {
					console.log(data);
					if(data.success == 0) {
						if(data.datas && data.datas.length > 0) {
							for(var i = 0; i < data.datas.length; i++) {
								var spec = data.datas[i];
								var inner_html = '<div class="top3item"><div class="img"><img src="'+spec.avatar+'" alt="img"></div>';
								inner_html += '<p><a href="item/'+spec.itemId+'.html">'+spec.itemName+'</a><br>'+spec.specName+'</p>';
								inner_html += '<div class="sold">已售出:'+spec.sellNumber+'件</div>';
								inner_html += '<div class="price">&yen;'+spec.discountPrice+'</div></div>';

								if(i == 0) {
									/*$('img.sidebarad').parent('a').attr('href', 'item/'+ spec.itemId +'.html');
									$('img.sidebarad').attr('src', spec.avatar);*/
								}
								
								$('div.top3').append(inner_html);
							}
						}
					}
				}
			});

			$(".sesearch input[name=sebtn], .sesearch .icon-magnifier13").click(function(){
				var href = window.location.href;
				var keyword = $(this).parents(".sesearch").children("input[type=text]").val();
				if (keyword) {
					window.location.href = href.split("?val=")[0]+"?val="+keyword;
				}else{
					window.location.href = href.split("?val=")[0];
				}
			});

			$(".filtermore").click(function(){
				if ($(".filter.hide").hasClass("active")) {
					$(".filter.hide").removeClass("active");
					$(".filtermore .fold").hide();
					$(".filtermore .show").show();
				}else{
					$(".filter.hide").addClass("active");
					$(".filtermore .fold").show();
					$(".filtermore .show").hide();
				}
			});

			$(".content .filtercb .checkbox").click(function(){
				var cb = $(this).children("input[type=checkbox]");

				if ($(this).hasClass("active")) {
					$(this).removeClass("active");
					cb.removeAttr("checked");
				}else{
					$(this).addClass("active");
					cb.attr("checked","checked");
				}

				if (cb.attr("checked")) {
					cb.parents(".filtercb").siblings("input.nolimit").removeClass("active");
					$(".selected .sltd").append('<div data-name='+cb.attr("data-name")+'>'+cb.attr("data-name")+'<span class="icon-cross"></span></div>');
					var cbn = $(this).parents(".filter").attr("name");
					if ( cbn == "minVolume" || cbn == "minDiscountPrice") {
						var dataname = $(this).parents(".fb").siblings(".fb").children(".checkbox").children("input[type=checkbox]");
						console.log(dataname);
						for (var i = 0; i < dataname.length; i++) {
							$(".selected .sltd div[data-name="+$(dataname[i]).attr("data-name")+"]").remove();
						}
						$(dataname).removeAttr("checked").parents(".checkbox").removeClass("active");
						$(this).addClass("active");

						cb.attr("checked","checked");
					}
				}else{
					$(".selected .sltd div[data-name="+cb.attr("data-name")+"]").remove();
					if (!$(this).parents(".fb").siblings(".fb").children(".checkbox").hasClass("active")) {
						$(this).parents(".filtercb").siblings("input.nolimit").addClass("active");
					}
				}
			});

			$(".selected .sltd div span.icon-cross").live("click",function(){
				var inputdata = $(this).parent("div").attr("data-name");
				$(this).parent("div").remove();
				$("input[type=checkbox][data-name="+inputdata+"]").parents(".checkbox").click();
			});

			$("input.nolimit").click(function(){
				$(this).addClass("active").siblings(".filtercb").children(".fb").children(".checkbox").removeClass("active").children("input[type=checkbox]").removeAttr("checked");
				var inputdata = $(this).siblings(".filtercb").children(".fb").children(".checkbox").children("input[type=checkbox]");
				for (var i = 0; i < inputdata.length; i++) {
					$('.selected .sltd div[data-name='+$(inputdata[i]).attr("data-name")+']').remove();
				}
			});

			function itemSearch(page, dataArray){
				if(!dataArray) {
					dataArray = [];
				}
				var filterKey = $(".filter");

				// if($('input[name=seinput]').val()) {
				// 	dataArray.push({
				// 		"key": "name",
				// 		"option": 1,
				// 		"val": $('input[name=seinput]').val(),
				// 		"page": page,
				// 		"limit": 2
				// 	});
				// }

				if ($(".sesearch input[name=seinput]").val()) {
					dataArray.push({
						"key": "name",
				 		"option": 1,
				 		"val": $(".sesearch input[name=seinput]").val(),
				 		"page": page,
				 		"limit": 9
					});
				}

				
				for (var i = 0; i < filterKey.length; i++) {
					//var checkedbox = $(filterKey[i]).children(".filtercb").children(".fb").children(".checkbox").children("input[type=checkbox]:checked");
					var checkedbox = $(filterKey[i]).find(":checked");

					var checkedboxVal = "";
					if (checkedbox.length) {
						for (var j = 0; j < checkedbox.length; j++) {
							if (j == checkedbox.length - 1) {
								checkedboxVal += $(checkedbox[j]).val();
							}else{
								checkedboxVal += $(checkedbox[j]).val() + ",";
							}
						};
						var thisOpt = $(filterKey[i]).children("input[name=opt]").val();
						if(checkedbox.attr("optChange") == "3") {
							thisOpt = 3;
						}
						dataArray.push({
							"key": $(filterKey[i]).children("input[name=key]").val(),
							"option": thisOpt,
							"val": checkedboxVal,
							"page": page,
							"limit": 9
						});
						//console.log($(filterKey[i]).children("input[name=key]").val());
					}
				};
				//console.log(dataArray);
				if (dataArray.length == 0) {
					dataArray.push({
						"key": null,
						"option": null,
						"val": null,
						"page": page,
						"limit": 9
					});
				}
				
				$.ajax({
					type: "POST",
					dataType: "json",      
					contentType : 'application/json',
					url: './sale/item/search',
					data: JSON.stringify(dataArray),
					success: function(data) {
						if (data.success == 0) {
							$(".total span").text(data.totalCount);
							$("#searchlist").empty();
							
							for (var i = 0; i < data.length; i++) {
								if(data.datas[i].minDiscountPrice == data.datas[i].minOriginalPrice
										|| !data.datas[i].minDiscountPrice) {
									$("#searchlist").append('<li data-itemid="' + data.datas[i].id
											+ '"><a href="./item/' + data.datas[i].id
											+ '.html"><div class="itemimg"><img src="' + data.datas[i].avatar
											+ '" alt="img"></div><div class="idetail"><p><span class="n">'
											+ data.datas[i].name
											+ '</span><br><span class="dp">'
											+ data.datas[i].minOriginalPrice
											+ '</span></p></div></a><div class="addtcart">加入购物车</div></li>');
								} else {
									$("#searchlist").append('<li data-itemid="' + data.datas[i].id
											+ '"><a href="./item/' + data.datas[i].id
											+ '.html"><div class="gp">特惠<div></div></div><div class="itemimg"><img src="' + data.datas[i].avatar
											+ '" alt="img"></div><div class="idetail"><p><span class="n">'
											+ data.datas[i].name
											+ '</span><br><span class="dp">'
											+ data.datas[i].minDiscountPrice
											+ '</span><span class="p">'
											+ data.datas[i].minOriginalPrice
											+ '</span></p></div></a><div class="addtcart">加入购物车</div></li>');
								}
							}
							$().pagegenerator(data.lastPage,page);
							$(".filterh, .filterb").removeClass("active");
						};
					}
				});
			}
			
			var url = window.location.search;
			var nameDA = [];
			if(url.split('?val=')[1]) {
				var itemName = decodeURI(decodeURI(url.split('?val=')[1]));
				if (itemName) {
					nameDA.push({
						"key": "name",
				 		"option": 1,
				 		"val": itemName,
				 		"page": 1,
				 		"limit": 9
					});
					$(".sesearch input[name=seinput]").val(itemName);
					itemSearch(1, []);
				}
			}else{
				itemSearch(1, []);
			}

			$("#ckMe").click(function() {
				itemSearch(1, []);
			});

			$(".page a:not(.current)").live("click",function(){
				var page = $(this).attr("class").split("pageid")[1];
				itemSearch(parseInt(page), []);
			});

			$(".page .nextpage").live("click",function(){
				var page = $(this).siblings("a.current").attr("class").split(" ")[0].split("pageid")[1];
				itemSearch(parseInt(page)+1, []);
			});

			$(".cartpp .ppb table tr").live('click',function(){
				$(".cartpp .ppb table .icon-checkmark").removeClass("active");
				$(this).children("td.td3").children(".icon-checkmark").addClass("active");
			});

			$(".cartpp .icon-minus").click(function(){
				var input = $(this).siblings(".num").children("input[type=text]");
				var v = input.val();
				input.val(parseInt(v)-1);
				input.blur();
			});

			$(".cartpp .icon-plus").click(function(){
				var input = $(this).siblings(".num").children("input[type=text]");
				var v = input.val();
				input.val(parseInt(v)+1);
				input.blur();
			});

			$(".cartpp .ppb .ppbt input[type=text]").blur(function(){
				if (isNaN($(this).val())) {
					$(this).val("1");
				}else if($(this).val() <= 0){
					$(this).val("1");
				}else if(parseInt($(this).val()) != $(this).val()){
					$(this).val(parseInt($(this).val()));
				}else if($(this).val() >= 99){
					$(this).val("99");
				}
			});

			$(".cartpp .ppf input[name=cancel]").click(function(){
				$(".cover, .cartpp").hide();
			});

			$(".cartpp .ppf input[name=addtc]").removeAttr("disabled");
			$(".cartpp .ppf input[name=addtc]").click(function(){

				var itemid = $(".cartpp .ppb").attr("data-itemid");
				var specid = $(".cartpp .ppb .icon-checkmark.active").parents("tr").attr("data-specid");
				var quantity = $(".cartpp .quantt input[type=text]").val();
				var cartpost = {
					"lightItem":{"id":itemid},
					"saleItemSpec":{"id":specid},
					"quantity":quantity
				};
				console.log(cartpost);
				$.ajax({
					type:"post",
					data:JSON.stringify(cartpost),
					contentType: 'application/json',
					dataType: 'json',
					async:false,
					cache:false,
					url:"./sale/cart",
					success:function(data){
						if (data.success == 0) {
							$(".cartpp .ppf input[name=cancel]").click();
							$().cartpost(itemid,specid,quantity);
							$().ddcartget();
							$().ddcartlistt();
						} else if(data.success == 55) {
							alert('库存不足，无法加入购物车');
						}
					}
				});
				$(".cartpp .ppf input[name=addtc]").removeAttr("disabled");
			});

			$("#searchlist li .addtcart").removeAttr("disabled");
			$("#searchlist li .addtcart").live("click",function(){
				$(this).attr("disabled","disabled");

				var itemid = $(this).parents("li").attr("data-itemid");

				$.ajax({
					type:"GET",
					data:{"itemId":itemid},
					url:"./sale/itemSpec",
					error:function(){
						$(this).removeAttr("disabled","disabled");
					},
					success:function(jsondata){
						if (jsondata.success == 0) {
							$(".cartpp .quantt input[type=text]").val(1);
							$(".cartpp .ppb table td").parents("tr").remove();

							$(".cartpp .ppb").attr("data-itemid",itemid);

							for (var i = 0; i < jsondata.datas.length; i++) {
								var spec = jsondata.datas[i];
								$(".cartpp .ppb table").append('<tr data-specid="'+spec.id+'"><td class="td1">'+spec.specName+'</td><td class="td2">&yen;'+spec.discountPrice+'</td><td class="td3"><div class="icon-checkmark"></div></td></tr>');
							}

							$(".cartpp .ppb table .icon-checkmark:eq(0)").addClass("active");
							$(".cover, .cartpp").show();
						}
						$(this).removeAttr("disabled","disabled");
					}
				});
			});
		});
	</script>
</body>
</html>