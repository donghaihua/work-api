<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>私人定制</title>
	<script src="js/html5.js"></script>
	<link rel="stylesheet" type="text/css" href="css/styleguide.css">
	<link rel="stylesheet" type="text/css" href="css/font.css">
	<link rel="stylesheet" type="text/css" href="css/packagedesign.css">
	
	<!-- ICON Files -->
	<link rel="shortcut icon" href="ico/favicon.ico">
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
</head>
<body>
	<iframe id='frameFilec' name='frameFilec' style='display: none;'></iframe>
	<header class="h2">
		<div class="h2b">
			<div class="sesearch">
				<input type="text">
				<span class="icon-magnifier13"></span>
			</div>
			<div class="logo">
				<img src="img/logo.png" alt="logo">
			</div>
			<div class="index">
				<a href="index.html">首页</a>
				<div class="dd2">
					<ul>
						<li><a href="culture.html">山茶文化</a></li>
						<li><a href="brand.html">品牌故事</a></li>
						<li><a href="packagedesign.html">私人定制</a></li>
						<li><a href="item_list.html">商品系列</a></li>
						<li><a href="contact.html">联系我们</a></li>
					</ul>
					<div class="lan">
						简
					</div>
					<div class="r">
						<a href="c_orderlist.html">我的订单</a>
						<a href="login.html">登录</a>|<a href="reg.html">注册</a>
					</div>
				</div>
			</div>
			<div class="secart">
				<a href="cart.html">
					购物车
					<div class="cartn">0</div>
				</a>
			</div>
		</div>
	</header>
	<header class="h1">
		<div class="box">
			<div class="logo">
				<img src="img/logo.png" alt="logo">
			</div>
			<div class="ul1">
				<ul>
					<!-- <li class="pinfo">
						<span>130****0000</span>
						<img src="img/avatar_preview_default.png" alt="avatar">
						<ul class="dd1">
							<li><a href="account.html">我的账户</a></li>
							<li>登出</li>
						</ul>
					</li> -->
					<li class="pinfo"><a href="login.html">登录</a>|<a href="reg.html">注册</a></li>
					<li><a href="c_orderlist.html">我的订单</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			<div class="bbs"><a href="bbs/forum.html">论坛</a></div>
			<div class="ul2">
				<ul>
					<li><a href="contact.html">联系我们</a></li>
					<li><a href="item_list.html">商品系列</a></li>
					<li><a href="packagedesign.html">私人定制</a></li>
					<li><a href="brand.html">品牌故事</a></li>
					<li><a href="culture.html">山茶文化</a></li>
					<li class="active"><a href="index.html">首页</a></li>
				</ul>
			</div>
		</div>
	</header>
	<div class="boxw se">
		<div class="box">
			<ul><li class="active">中</li><li>繁</li><li>JP</li><li>EN</li></ul>
			<div class="sesearch">
				<input type="text" name="seinput">
				<input type="button" name="sebtn" value="搜索">
			</div>
			<div class="secart">
				<a href="cart.html">
					购物车
					<div class="cartn">0</div>
					<span class="icon-arrow-down2"></span>
				</a>
			</div>
		</div>
	</div>
	<div class="clear waypoint"></div>
	<div class="box hcl">
		<div class="hcartlist">
			<div class="list">
				<table>
					<!-- <tr>
						<td class="td1">
							<div class="img">
								<img src="img/listitem.png" alt="img">
							</div>
							<p>
								<span class="n">红天果冷压榨特级初榨茶籽油</span><br>
								<span class="s">500ML</span>
							</p>
						</td>
						<td class="td2">1</td>
						<td class="td3">&yen;200</td>
						<td class="td4">
							<span class="icon-cross"></span>
						</td>
					</tr> -->
				</table>
			</div>
			<div class="b">
				<span class="ttn">共<span>0</span>件商品</span>
				<span class="ttp">总价<span>&yen;0</span></span>
				<input type="button" id="carthtml" value="结算">
			</div>
		</div>
	</div>
	<div class="content boxw">
		<div class="banner"></div>
		<div class="tabnav">
			<ul>
				<li class="active" name="tab1">全部作品</li>
				<li name="tab2">活动介绍</li>
				<li name="tab3">上传作品</li>
			</ul>
		</div>
		<div class="tab tab1">
			<div class="totalnum">作品数量：<span></span></div>
			<ul class="worklist">
				<!-- <li>
					<div class="img">
						<img src="img/packageimg.jpg" alt="packageimg">
					</div>
					<div class="detail">
						<h3>包装设计</h3>
						<div class="avatar">
							<img src="img/avatar_preview_default.png" alt="ava">
						</div>
						<div class="authorinfo">rad***ps@yahoo.cn</div>
						<div class="vote active">
							<span>
								<span class="icon-heart"></span>
								<span class="icon-heart2"></span>
								12
							</span>
						</div>
					</div>
				</li>
				<li>
					<div class="img">
						<img src="img/packageimg.jpg" alt="packageimg">
					</div>
					<div class="detail">
						<h3>包装设计</h3>
						<div class="avatar">
							<img src="img/avatar_preview_default.png" alt="ava">
						</div>
						<div class="authorinfo">rad***ps@yahoo.cn</div>
						<div class="vote">
							<span>
								<span class="icon-heart"></span>
								<span class="icon-heart2"></span>
								12
							</span>
						</div>
					</div>
				</li> -->
			</ul>
			<div class="clear"></div>
			<div class="listdetail"></div>
			<div class="pager">
				<span class="page">
					<a>1</a>
					<a class="current">2</a>
					<a>3</a>
					<a>4</a>
					<a>5</a>
					<span>&hellip;</span>
					<a>17</a>
					<span class="nextpage">下一页<span class="icon-arrow-right2"></span></span>
				</span>
			</div>
		</div>
		<div class="tab tab2">
			<h3>活动介绍：</h3>
			<p>尊敬的会员，请您将包装设计作品上传到本栏目并留下联系方式，我们将会尽快与您联系，详谈私人定制事宜。感谢您对有好油的支持！</p>
		</div>
		<div class="tab tab3">
			<div class="uploadinfo">
				<div class="ava">
					<img src="img/avatar_preview_default.png" alt="ava">
				</div>
				<div class="username">ra****ps@yahoo.cn</div>
				<div class="telephone">联系方式<span>139***898</span></div>
			</div>
			<div class="uploadform">
				<p>系列</p>
				<div>
					<select id="series">
						<option value="0">中国风系列</option>
						<option value="1">历史文化系列</option>
					</select>
				</div>
				<p>标题</p>
				<div>
					<div class="error"><div></div><span>必填</span></div>
					<input type="text" maxlength="12" id="ftitle">
				</div>
				<p>介绍</p>
				<div>
					<div class="error"><div></div><span>必填</span></div>
					<textarea maxlength="500" id="fintro"></textarea>
				</div>
				<p>版权</p>
				<div>
					<select id="copyright">
						<option value="0">禁止匿名转载；禁止商业使用；禁止个人使用</option>
						<option value="1">禁止匿名转载；禁止商业使用</option>
						<option value="2">不限制作品用途</option>
					</select>
				</div>
				<p>上传封面</p>
				<div>
					<div class="error"><div></div><span>请上传封面</span></div>
					<div class="workcover">
						<form class="coverupload" method="post" action="./s/work/upload" enctype="multipart/form-data" target='frameFilec'>
							<input type="file" name="cover">
						</form>
						<input class="bluer" type="button" id="addcover" value="上传">
						<p>276px X 226px</p>
						<img src="img/packageimg.jpg" alt="cover">
						<input class="editbtn" id="editcover" type="button" value="编辑">
					</div>
				</div>
				<p>上传作品</p>
				<div class="images">
					<div class="error"><div></div><span>请上传至少一张作品</span></div>
					<ul>
						<!-- <li>
							<img src="img/packageimg.jpg" alt="packageimg">
							<input class="editbtn" type="button" value="删除">
						</li> -->
						<li class="newimg">
							<form class="imgupload" method="post" action="./s/work/upload" enctype="multipart/form-data" target='frameFilec'>
								<input type="file" name="file1">
							</form>
							<input class="bluer" type="button" id="addimg" value="上传">
							<p>支持jpg,png;最多上传8张图片</p>
						</li>
					</ul>
					<div class="clear"></div>
				</div>
				<div class="checkbox icon-checkmark checked"></div>
				<span class="agreement">我已同意大赛征集规则等所有条款</span>
				<div class="btn">
					<input class="red" type="button" id="submit" value="发布">
					<input class="white" type="button" id="cancel" value="取消">
					<span>发布失败，请检查网络连接后重试</span>
				</div>
			</div>
		</div>
	</div>
	<footer>
		<div class="box">
			<div class="l">
				<p>
					客户服务<br>
					<span id="site_phone">025-85703619</span>
				</p>
				<p>
					地址<br>
					<span id="site_address">江苏省南京市雨花台区长虹路222号<br>
						德盈国际广场3幢1605室<br>
						江苏红果文化传播有限公司</span>
				</p>
				<p>
					邮箱<br>
					<span id="site_email">srv@uhaou.cn</span>
				</p>
			</div>
			<div class="m">
				<p>订阅有好油，加入我们</p>
				<div class="rss">
					<input type="text" placeholder="请输入您的邮箱">
					<input type="button" value="发送">
				</div>
			</div>
			<div class="r">
				<p>扫一扫有惊喜</p>
				<img id="site_2dcode" src="img/2dcode.jpg" alt="code">
				<div class="site">UHAOU.CN</div>
				<div class="cr" id="site_record">
				</div>
			</div>
		</div>
	</footer>
	<script src="js/jquery.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script src="js/general.js"></script>
	<script src="js/waypoints.min.js"></script>
	<script type="text/javascript">
	$().ready(function(){
		$(".checkbox").click(function(){
			if ($(this).hasClass("checked")) {
				$(this).removeClass("checked");
			}else{
				$(this).addClass("checked");
			}
		});

		$(".vote").live('click',function(){
			var vote = $(this);
			var workid = $(this).parents("li").attr("data-workid");
			if (!$(this).hasClass("active")) {
				if (loginStatus() == 0) {
					$.ajax({
						type:"post",
						data:{
							"workId": workid,
							"accountId": accountid
						},
						url:"./s/work/up",
						success:function(data){
							if (data.success == 0) {
								vote.addClass("active");
							}
						}
					});
				}else{
					alert("请先登录");
				}
			}
			return false;
		});

		function loginStatus(){
			if (loginData) {
				if (loginData.success == 0) {
					return 0;
				}else{
					return 1;
				}
			}else{
				return 1;
			}
		}

		$(".tabnav li").click(function(){
			if ($(this).attr("name").split("tab")[1] == 3) {
				if (loginStatus() == 0) {
					$(".tab3 .uploadinfo .username").text(loginData.userName);
					$(".tab3 .uploadinfo .telephone span").text(loginData.telephone);
				}else{
					window.location.href="login.html";
				}
			}
			$(".tab").hide();
			$(".tabnav li").removeClass("active");
			$(this).addClass("active");
			$("."+$(this).attr("name")).show();
		});

		var tabid = 1;
		if (window.location.search) {
			tabid = window.location.search.split("tab=")[1];
		}
		$(".tabnav li[name=tab"+tabid+"]").click();

		function getDesignwork(page){
			$.ajax({
				type: "get",
				data: {
					"page": page,
					"limit": 2,
					"state": 0
				},
				url:"./s/works",
				cache: false,
				async: false,
				error:function(){

				},
				success:function(data){
					if (data.success == 0) {
						$().pagegenerator(data.datas.currentPage,data.datas.pageCount);
						$(".totalnum span").text(data.datas.totalCount);
						$(".listdetail").text('共'+data.datas.totalCount+'作品');
						$(".worklist").empty();
						if (data.datas.results.length) {
							var str = "";
							for (var i = data.datas.results.length - 1; i >= 0; i--) {
								str += '<li data-workid="'+data.datas.results[i].id+'">'
											+'<a href="packagework.html?workid='+data.datas.results[i].id+'" target="_blank"><div class="img"><img src="'+data.datas.results[i].cover+'" alt="packageimg"></div>'
										+'<div class="detail">'
											+'<h3>'+data.datas.results[i].title+'</h3>'
											+'<div class="avatar">'
												+'<img src="img/avatar_preview_default.png" alt="ava">'
											+'</div>'
											+'<div class="authorinfo">'+data.datas.results[i].user.userName+'</div>';
								if (!data.datas.results[i].isHeart) {
									str += '<div class="vote active">';
								}else{
									str += '<div class="vote">';
								}
								str +='<span>'+'<span class="icon-heart"></span>'
													+'<span class="icon-heart2"></span>'
													+data.datas.results[i].totalHeart
												+'</span>'
											+'</div>'
										+'</div></a>'
									+'</li>';
							}
							$(".worklist").append(str);
						}
					}
				}
			});
		}

		getDesignwork(1);

		$(".page a:not(.current)").live("click",function(){
			var page = $(this).attr("class").split("pageid")[1];
			getDesignwork(parseInt(page));
		});

		$(".page .nextpage").live("click",function(){
			var page = $(this).siblings("a.current").attr("class").split(" ")[0].split("pageid")[1];
			getDesignwork(parseInt(page)+1);
		});

		$("#cancel").click(function(){
			$(".tabnav li[name=tab1]").click();
		});

		var sus = 1;

		$("#ftitle").blur(function(){
			var v = $(this).val();
			var tip = "";
			if (!v) {
				tip = "必填";
			}else if(!$().stringvalidate(v)){
				tip = "请不要使用特殊符号";
			}
			if(tip){
				$(this).siblings(".error").show().children("span").text(tip);
				sus = 0;
			}else{
				$(this).siblings(".error").hide();
			}
		});

		$("#fintro").blur(function(){
			var v = $(this).val();
			var tip = "";
			if (!v) {
				tip = "必填";
			}else if(!$().stringvalidate(v)){
				tip = "请不要使用特殊符号";
			}
			if(tip){
				$(this).siblings(".error").show().children("span").text(tip);
				sus = 0;
			}else{
				$(this).siblings(".error").hide();
			}
		});

		$("#addcover, #editcover").click(function(){
			$(".workcover p").text("276px X 226px");
			$(this).siblings(".coverupload").children("input[name=cover]").click();

		});

		$("#addimg").click(function(){
			$(".images .error").hide();
			$(".newimg p").text("支持jpg,png");
			$(this).siblings(".imgupload").children("input[name=file1]").click();
		});

		$(".coverupload input[name=cover]").change(function(){
			$(this).addClass("uploading").parent(".coverupload").submit();
			$(".workcover p").text("正在上传...");
		});

		$(".imgupload input[name=file1]").change(function(){
			$(".images .error").hide();
			if ($(".images ul li img").length < 8) {
				$(this).addClass("uploading").parent(".imgupload").submit();
				$(".newimg p").text("正在上传...");
			}else{
				$(".images .error").show().children("span").text("最多上传8张图片");
			}
		});

		$(".images .editbtn").click(function(){
			$(this).parent("li").remove();
		});

		$(".images ul li input.editbtn").live('click',function(){
			$(this).parents("li").remove();
			if ($(".images ul li img").length < 8) {
				$(".newimg").show();
			}else{
				$(".newimg").hide();
			}
		});

		$("#submit").click(function(){
			$(this).attr("disabled","disabled");
			$(".tab3 .uploadform .btn span").hide();
			var sus = 1;
			$(".error").hide();
			$("#ftitle").blur();
			$("#fintro").blur();
			if ($(".workcover.active").length == 0) {
				sus = 0;
				$(".workcover").siblings(".error").show().children("span").text("请上传封面");
			}else if(!$(".workcover.active img").attr("src")){
				sus = 0;
				$(".workcover").siblings(".error").show().children("span").text("请上传封面");
			}

			if ($(".images ul li img").length == 0) {
				sus = 0;
				$(".images .error").show().children("span").text("请上传至少一张作品");
			}

			if(!$(".uploadform .checkbox").hasClass("checked")){
				sus = 0;
				alert("请确认同意大赛征集规则等所有条款");
			}

			if (sus) {
				var imgArray = ["","","","","","","",""];
				for (var i = 0; i < $(".images ul li img").length; i++) {
					imgArray[i] = $($(".images ul li img")[i]).attr("src");
				}
				console.log(imgArray);
				var item = {
						"title":$("#ftitle").val(),
						"introduction":$("#fintro").val(),
						"copyright": $("#copyright").val(),
						"cover":$(".workcover img").attr("src"),
						"img1":imgArray[0],
						"img2":imgArray[1],
						"img3":imgArray[2],
						"img4":imgArray[3],
						"img5":imgArray[4],
						"img6":imgArray[5],
						"img7":imgArray[6],
						"img8":imgArray[7],
						"series": $("#series").val()
				};
				$.ajax({
					type:"post",
					dataType: "json",      
					contentType : 'application/json',
					data: JSON.stringify(item),
					url:"./s/work",
					error:function(){
						$(".tab3 .uploadform .btn span").text("发布失败，请检查网络连接后重试");
					},
					success:function(data){
						if (data.success == 0) {
							window.location.href="packagework.html?workid="+data.workId;
						}else if(data.error == 402){
							$(".tab3 .uploadform .btn span").text("请登录后发布");
						}else{
							$(".tab3 .uploadform .btn span").text("发布失败");
						}
					}
				});
			}
			$(this).removeAttr("disabled");
		});
	});

	function imgUploadSuccess(msg){
		console.log(msg);
		var type = $("input[type=file].uploading").attr("name");
		$("input[type=file].uploading").removeClass("uploading");
		if (type == "cover") {
			$(".workcover p").text("276px X 226px");
			$(".workcover").siblings(".error").hide();
			if (msg.split('|')[0] == 0) {
				$(".workcover").addClass("active").children("img").attr("src",msg.split('|')[1]);
			}else if(msg.split('|')[0] == 2){
				$(".workcover").siblings(".error").show().children("span").text("请上传不超过1M的图片");
			}else{
				$(".workcover").siblings(".error").show().children("span").text("上传失败，请重试");
			}
		}else if (type == "file1"){
			$(".images .error").hide();
			if (msg.split('|')[0] == 0) {
				$(".newimg").before('<li>'
						+'<img src="'+msg.split('|')[1]+'" alt="packageimg">'
						+'<input class="editbtn" type="button" value="删除">'
					+'</li>');
				$(".newimg p").text("支持jpg,png");
			}else if(msg.split('|')[0] == 2){
				$(".newimg p").text("请上传不超过2M的图片");
			}else{
				$(".newimg p").text("上传失败，请重试");
			}
			if ($(".images ul li img").length < 8) {
				$(".newimg").show();
			}else{
				$(".newimg").hide();
			}
		}
	}
	</script>
</body>
</html>